<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCCåŒ–å­¦ Â· ç™»å½•æ³¨å†Œ</title>
    <!-- ä½¿ç”¨å›½å†…é•œåƒåŠ è½½ Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        
        body { 
            background: linear-gradient(145deg, #f0f9ff 0%, #e6f0f5 100%); 
            min-height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 20px;
        }
        
        .card { 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 40px; 
            box-shadow: 0 30px 60px -15px rgba(27, 58, 85, 0.3), 0 0 0 1px rgba(43, 110, 155, 0.1) inset; 
            width: 100%; 
            max-width: 480px; 
            padding: 48px 36px; 
            text-align: center; 
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        h1 { 
            font-size: 3rem; 
            font-weight: 700;
            background: linear-gradient(135deg, #1e3c5a, #2b6e9b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px; 
            letter-spacing: -0.02em;
        }
        
        .sub { 
            color: #527a9b; 
            margin-bottom: 40px; 
            font-size: 1.1rem;
            font-weight: 500;
            border-bottom: 2px solid #e9f0f5;
            padding-bottom: 20px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 36px;
            background: #f1f5f9;
            padding: 6px;
            border-radius: 60px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 14px 20px;
            border-radius: 60px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #64748b;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background: white;
            color: #2b6e9b;
            box-shadow: 0 8px 20px -8px rgba(43,110,155,0.3);
        }
        
        .input-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .input-field { 
            width: 100%; 
            padding: 18px 24px; 
            border-radius: 60px; 
            border: 2px solid #e2e8f0; 
            font-size: 1rem; 
            outline: none; 
            background: white;
            transition: all 0.2s ease;
            padding-right: 60px;
        }
        
        .input-field:focus { 
            border-color: #2b6e9b; 
            box-shadow: 0 0 0 4px rgba(43,110,155,0.15);
        }
        
        .input-field::placeholder {
            color: #94a3b8;
            font-weight: 400;
        }
        
        .input-field:disabled {
            background: #f1f5f9;
            color: #475569;
            border-color: #e2e8f0;
        }
        
        .password-toggle {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #2b6e9b;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 30px;
            transition: all 0.2s ease;
            background: rgba(43, 110, 155, 0.1);
        }
        
        .password-toggle:hover {
            background: rgba(43, 110, 155, 0.2);
        }
        
        .btn { 
            width: 100%; 
            background: #2b6e9b; 
            color: white; 
            border: none; 
            padding: 18px; 
            border-radius: 60px; 
            font-weight: 600; 
            font-size: 1.1rem; 
            cursor: pointer; 
            margin-bottom: 16px; 
            transition: all 0.2s ease;
            box-shadow: 0 10px 20px -8px rgba(43,110,155,0.4);
        }
        
        .btn:hover { 
            background: #1d4f73; 
            transform: translateY(-2px);
            box-shadow: 0 15px 25px -8px rgba(43,110,155,0.5);
        }
        
        .btn-outline { 
            background: transparent; 
            border: 2px solid #2b6e9b; 
            color: #2b6e9b; 
            box-shadow: none;
        }
        
        .btn-outline:hover { 
            background: #e6f0f7; 
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -8px rgba(43,110,155,0.2);
        }
        
        .hidden { display: none; }
        
        .message { 
            color: #b91c1c; 
            margin: 16px 0; 
            min-height: 24px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .success { 
            color: #2b6e9b; 
            min-height: 24px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .admin-note {
            margin-top: 24px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 30px;
            font-size: 1rem;
            color: #475569;
            border: 1px solid #e2e8f0;
            text-align: center;
            line-height: 1.6;
        }
        
        .admin-note strong {
            color: #2b6e9b;
            font-size: 1.1rem;
            display: block;
            margin-bottom: 8px;
        }
        
        .footer-note {
            margin-top: 24px;
            color: #94a3b8;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>âš—ï¸ DCC</h1>
        <div class="sub">åŒ–å­¦ç¤¾å›¢ Â· çŸ¥è¯†è®²è§£</div>
        
        <div class="tab-buttons">
            <button class="tab-btn active" id="btnStudent">å­¦å‘˜</button>
            <button class="tab-btn" id="btnAdmin">ç®¡ç†å‘˜</button>
        </div>

        <!-- å­¦å‘˜åŒºåŸŸ -->
        <div id="studentSection">
            <div class="input-container">
                <input type="text" class="input-field" id="studentName" placeholder="è¯·è¾“å…¥å§“å">
            </div>
            <div class="input-container">
                <input type="password" class="input-field" id="studentPass" placeholder="è¯·è¾“å…¥å¯†ç ">
                <button class="password-toggle" onclick="togglePassword('studentPass')">æ˜¾ç¤º</button>
            </div>
            <button class="btn" id="studentLoginBtn">ğŸ” ç™»å½•</button>
            <button class="btn btn-outline" id="studentRegisterBtn">ğŸ“ æ³¨å†Œæ–°è´¦å·</button>
        </div>

        <!-- ç®¡ç†å‘˜åŒºåŸŸ -->
        <div id="adminSection" class="hidden">
            <div class="input-container">
                <input type="text" class="input-field" value="admin" disabled>
            </div>
            <div class="input-container">
                <input type="password" class="input-field" id="adminPass" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
                <button class="password-toggle" onclick="togglePassword('adminPass')">æ˜¾ç¤º</button>
            </div>
            <button class="btn" id="adminLoginBtn">ç®¡ç†å‘˜ç™»å½•</button>
            <div id="adminMessage" class="message"></div>
            <div class="admin-note">
                <strong>ğŸ‘¥ åŒå­¦ç™»å½•</strong>
                è¯·åœ¨å·¦ä¾§ã€Œå­¦å‘˜ã€é€‰é¡¹å¡ä¸­ç™»å½•<br>
                ä½¿ç”¨æ‚¨çš„å­¦å‘˜è´¦å·å’Œå¯†ç 
            </div>
        </div>

        <div id="globalMessage" class="message"></div>
        <div id="successMessage" class="success"></div>
        <div class="footer-note">åŠ å…¥ DCCï¼Œæ¢ç´¢åŒ–å­¦çš„å¥¥ç§˜</div>
    </div>

    <script>
        // å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢å‡½æ•°
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = event.target;
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'éšè—';
            } else {
                input.type = 'password';
                button.textContent = 'æ˜¾ç¤º';
            }
        }

        // Supabase é…ç½®
        const SUPABASE_URL = 'https://fdwacsuphbpxfariohan.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZkd2Fjc3VwaGJweGZhcmlvaGFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExMDM1MzcsImV4cCI6MjA4NjY3OTUzN30.q1CzBhIw8xVYL4efkTvGYLkeC04dnBSCPcAWk7LHxxU';
        
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // DOM å…ƒç´ 
        const btnStudent = document.getElementById('btnStudent');
        const btnAdmin = document.getElementById('btnAdmin');
        const studentSection = document.getElementById('studentSection');
        const adminSection = document.getElementById('adminSection');
        const globalMsg = document.getElementById('globalMessage');
        const successMsg = document.getElementById('successMessage');
        const adminMsg = document.getElementById('adminMessage');

        function clearMessages() {
            globalMsg.innerText = '';
            successMsg.innerText = '';
            if (adminMsg) adminMsg.innerText = '';
        }

        // é€‰é¡¹å¡åˆ‡æ¢
        btnStudent.onclick = function() {
            btnStudent.classList.add('active');
            btnAdmin.classList.remove('active');
            studentSection.classList.remove('hidden');
            adminSection.classList.add('hidden');
            clearMessages();
        };

        btnAdmin.onclick = function() {
            btnAdmin.classList.add('active');
            btnStudent.classList.remove('active');
            adminSection.classList.remove('hidden');
            studentSection.classList.add('hidden');
            clearMessages();
        };

        // å­¦å‘˜ç™»å½•
        document.getElementById('studentLoginBtn').onclick = async function() {
            const name = document.getElementById('studentName').value.trim();
            const pass = document.getElementById('studentPass').value.trim();
            clearMessages();

            if (!name || !pass) {
                globalMsg.innerText = 'è¯·å¡«å†™å§“åå’Œå¯†ç ';
                return;
            }

            try {
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('name', name)
                    .eq('password', pass)
                    .eq('role', 'student');

                if (error) throw error;

                if (data && data.length > 0) {
                    sessionStorage.setItem('userId', data[0].id);
                    sessionStorage.setItem('userName', data[0].name);
                    sessionStorage.setItem('userRole', data[0].role);
                    
                    successMsg.innerText = 'âœ… ç™»å½•æˆåŠŸï¼Œæ­£åœ¨è·³è½¬...';
                    setTimeout(() => {
                        window.location.href = 'student.html';
                    }, 1000);
                } else {
                    globalMsg.innerText = 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯';
                }
            } catch (error) {
                globalMsg.innerText = 'ç™»å½•å¤±è´¥ï¼š' + error.message;
                console.error(error);
            }
        };

        // å­¦å‘˜æ³¨å†Œ
        document.getElementById('studentRegisterBtn').onclick = async function() {
            const name = document.getElementById('studentName').value.trim();
            const pass = document.getElementById('studentPass').value.trim();
            clearMessages();

            if (!name || !pass) {
                globalMsg.innerText = 'è¯·å¡«å†™å§“åå’Œå¯†ç ';
                return;
            }

            try {
                const { data: existing } = await supabaseClient
                    .from('users')
                    .select('id')
                    .eq('name', name);

                if (existing && existing.length > 0) {
                    globalMsg.innerText = 'ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·ç›´æ¥ç™»å½•';
                    return;
                }

                const { error } = await supabaseClient
                    .from('users')
                    .insert([{ name, password: pass, role: 'student' }]);

                if (error) throw error;

                successMsg.innerText = 'âœ… æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•';
                document.getElementById('studentPass').value = '';
                
            } catch (error) {
                globalMsg.innerText = 'æ³¨å†Œå¤±è´¥ï¼š' + error.message;
                console.error(error);
            }
        };

        // ç®¡ç†å‘˜ç™»å½•
        document.getElementById('adminLoginBtn').onclick = async function() {
            const pass = document.getElementById('adminPass').value.trim();
            if (adminMsg) adminMsg.innerText = '';

            // ç®¡ç†å‘˜å¯†ç ä»ç„¶æ˜¯ DailyChemClubï¼Œä½†ä¸æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š
            if (pass !== 'DailyChemClub') {
                if (adminMsg) adminMsg.innerText = 'âŒ å¯†ç é”™è¯¯';
                return;
            }

            try {
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('name', 'admin')
                    .eq('role', 'admin');

                if (error) throw error;

                if (data && data.length > 0) {
                    sessionStorage.setItem('userId', data[0].id);
                    sessionStorage.setItem('userName', data[0].name);
                    sessionStorage.setItem('userRole', data[0].role);
                    
                    if (adminMsg) adminMsg.innerText = 'âœ… ç™»å½•æˆåŠŸï¼Œæ­£åœ¨è·³è½¬...';
                    setTimeout(() => {
                        window.location.href = 'admin.html';
                    }, 1000);
                } else {
                    if (adminMsg) adminMsg.innerText = 'âŒ ç®¡ç†å‘˜è´¦å·ä¸å­˜åœ¨';
                }
            } catch (error) {
                if (adminMsg) adminMsg.innerText = 'âŒ ç™»å½•å¤±è´¥ï¼š' + error.message;
                console.error(error);
            }
        };
    </script>
</body>
</html>