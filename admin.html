<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>DCC Â· ç®¡ç†åå°</title>
    <!-- ä½¿ç”¨å’Œä¹‹å‰ç›¸åŒçš„ CDN -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        
        body { 
            background: linear-gradient(145deg, #f1f5f9 0%, #e6edf5 100%);
            min-height: 100vh;
        }
        
        /* å¯¼èˆªæ  - ç§»åŠ¨ç«¯é€‚é… */
        .navbar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 16px 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
            border-bottom: 1px solid rgba(43, 110, 155, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        @media (min-width: 768px) {
            .navbar {
                flex-direction: row;
                justify-content: space-between;
                padding: 20px 40px;
            }
        }
        
        .navbar h2 {
            color: #1e405e;
            font-size: 1.3rem;
            font-weight: 600;
            letter-spacing: -0.02em;
        }
        
        @media (min-width: 768px) {
            .navbar h2 {
                font-size: 1.5rem;
            }
        }
        
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 20px 16px;
        }
        
        @media (min-width: 768px) {
            .container {
                padding: 32px 24px;
            }
        }
        
        /* é€‰é¡¹å¡ - ç§»åŠ¨ç«¯å¯æ»‘åŠ¨ */
        .tabs-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 20px;
            padding-bottom: 5px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            min-width: max-content;
            padding: 4px;
            background: white;
            border-radius: 60px;
            box-shadow: 0 10px 25px -8px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(43, 110, 155, 0.1);
        }
        
        @media (min-width: 768px) {
            .tabs {
                min-width: 100%;
                gap: 16px;
            }
        }
        
        .tab-btn {
            padding: 12px 20px;
            border-radius: 60px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        @media (min-width: 768px) {
            .tab-btn {
                padding: 14px 28px;
                font-size: 1rem;
            }
        }
        
        .tab-btn.active {
            background: #2b6e9b;
            color: white;
            box-shadow: 0 8px 20px -8px rgba(43, 110, 155, 0.5);
        }
        
        .panel {
            background: white;
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(43, 110, 155, 0.1);
            transition: transform 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .panel {
                border-radius: 32px;
                padding: 32px;
                margin-bottom: 30px;
            }
        }
        
        .panel:hover {
            transform: translateY(-5px);
        }
        
        .panel h3 {
            color: #1e405e;
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9f0f5;
        }
        
        @media (min-width: 768px) {
            .panel h3 {
                font-size: 1.5rem;
                margin-bottom: 25px;
                padding-bottom: 15px;
            }
        }
        
        .panel h4 {
            color: #2b6e9b;
            font-size: 1.1rem;
            margin: 20px 0 15px;
        }
        
        @media (min-width: 768px) {
            .panel h4 {
                font-size: 1.2rem;
                margin: 30px 0 20px;
            }
        }
        
        /* è¡¨æ ¼å®¹å™¨ - å¯æ¨ªå‘æ»‘åŠ¨ */
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 15px 0;
            border-radius: 16px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        
        @media (min-width: 1200px) {
            table {
                min-width: 100%;
            }
        }
        
        th {
            text-align: left;
            padding: 12px 8px;
            background: #f8fafc;
            color: #1e405e;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        @media (min-width: 768px) {
            th {
                padding: 16px 12px;
                font-size: 0.9rem;
            }
        }
        
        td {
            padding: 12px 8px;
            border-bottom: 1px solid #e9f0f5;
            color: #475569;
            vertical-align: middle;
            word-break: break-word;
            font-size: 0.85rem;
        }
        
        @media (min-width: 768px) {
            td {
                padding: 16px 12px;
                font-size: 0.9rem;
            }
        }
        
        tr:hover td {
            background: #f8fafc;
        }
        
        /* æŒ‰é’®ç»„ */
        .action-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        /* é«˜äº®æ ·å¼ - ä»Šå¤©è¯¾ç¨‹ */
        .today-highlight {
            background: linear-gradient(145deg, #fff3cd, #fef9e7);
        }
        
        /* é«˜äº®æ ·å¼ - æ˜å¤©è¯¾ç¨‹ */
        .tomorrow-highlight {
            background: linear-gradient(145deg, #bae7ff, #e6f7ff);
        }
        
        /* å·²ç»“æŸè¯¾ç¨‹æ ·å¼ */
        .ended-course {
            opacity: 0.6;
            background: #f1f5f9;
            position: relative;
        }
        
        .ended-course td {
            color: #94a3b8;
        }
        
        .ended-badge {
            display: inline-block;
            background: #94a3b8;
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 20px;
            margin-left: 8px;
        }
        
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .badge-today {
            background: #f59e0b;
            color: white;
        }
        
        .badge-tomorrow {
            background: #1890ff;
            color: white;
        }
        
        .badge-ended {
            background: #94a3b8;
            color: white;
        }
        
        input, select, textarea {
            padding: 10px 16px;
            border-radius: 30px;
            border: 2px solid #e2e8f0;
            width: 100%;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.2s ease;
            background: white;
        }
        
        @media (min-width: 768px) {
            input, select, textarea {
                padding: 12px 20px;
                font-size: 1rem;
            }
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #2b6e9b;
            box-shadow: 0 0 0 4px rgba(43, 110, 155, 0.1);
        }
        
        textarea {
            border-radius: 30px;
            resize: vertical;
            min-height: 60px;
            max-height: 200px;
            line-height: 1.5;
        }
        
        @media (min-width: 768px) {
            textarea {
                min-height: 80px;
                max-height: 300px;
            }
        }
        
        .btn {
            background: #2b6e9b;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(43, 110, 155, 0.2);
            font-size: 0.8rem;
            white-space: nowrap;
        }
        
        @media (min-width: 768px) {
            .btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
        }
        
        .btn:hover {
            background: #1d4f73;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(43, 110, 155, 0.3);
        }
        
        .btn-edit {
            background: #2b6e9b;
        }
        
        .btn-danger {
            background: #b91c1c;
            box-shadow: 0 4px 12px rgba(185, 28, 28, 0.2);
        }
        
        .btn-danger:hover {
            background: #7f1515;
            box-shadow: 0 8px 20px rgba(185, 28, 28, 0.3);
        }
        
        /* æ–°å¢è¯¾ç¨‹è¡¨å• - ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 15px 0 10px;
            background: #f8fafc;
            padding: 16px;
            border-radius: 20px;
            border: 1px solid #e2e8f0;
        }
        
        @media (min-width: 768px) {
            .btn-group {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 16px;
                padding: 24px;
                border-radius: 30px;
            }
        }
        
        .btn-group input, .btn-group select, .btn-group textarea {
            flex: 1;
            min-width: auto;
        }
        
        @media (min-width: 768px) {
            .btn-group input, .btn-group select, .btn-group textarea {
                min-width: 200px;
            }
        }
        
        .btn-group textarea {
            min-height: 60px;
        }
        
        @media (min-width: 768px) {
            .btn-group textarea {
                min-height: 100px;
            }
        }
        
        .time-input-group {
            display: flex;
            gap: 6px;
            align-items: center;
            flex: 1;
        }
        
        @media (min-width: 768px) {
            .time-input-group {
                gap: 8px;
                min-width: 200px;
            }
        }
        
        .time-input-group input {
            flex: 1;
            min-width: 80px;
        }
        
        @media (min-width: 768px) {
            .time-input-group input {
                min-width: 100px;
            }
        }
        
        .time-separator {
            color: #64748b;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* ä¿®æ”¹å¼¹çª— - ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 12px;
        }
        
        @media (min-width: 768px) {
            .modal-overlay {
                padding: 20px;
            }
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 28px;
            padding: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            transform: translateY(30px);
            transition: all 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .modal-content {
                border-radius: 40px;
                padding: 32px;
                max-height: 90vh;
            }
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-content h3 {
            color: #1e405e;
            font-size: 1.4rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eef5f9;
        }
        
        @media (min-width: 768px) {
            .modal-content h3 {
                font-size: 1.8rem;
                margin-bottom: 25px;
                padding-bottom: 15px;
            }
        }
        
        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        @media (min-width: 768px) {
            .modal-form {
                gap: 20px;
            }
        }
        
        .modal-form .form-row {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        @media (min-width: 768px) {
            .modal-form .form-row {
                gap: 8px;
            }
        }
        
        .modal-form .form-row label {
            font-weight: 600;
            color: #1e405e;
            font-size: 0.9rem;
        }
        
        @media (min-width: 768px) {
            .modal-form .form-row label {
                font-size: 1rem;
            }
        }
        
        .modal-form .form-row input,
        .modal-form .form-row select,
        .modal-form .form-row textarea {
            width: 100%;
            padding: 10px 14px;
            font-size: 0.9rem;
        }
        
        @media (min-width: 768px) {
            .modal-form .form-row input,
            .modal-form .form-row select,
            .modal-form .form-row textarea {
                padding: 14px 18px;
                font-size: 1rem;
            }
        }
        
        .modal-form .time-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .modal-form .time-row input {
            flex: 1;
        }
        
        .modal-form .time-row span {
            color: #64748b;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        @media (min-width: 768px) {
            .modal-buttons {
                gap: 15px;
                margin-top: 25px;
            }
        }
        
        .modal-buttons .btn {
            flex: 1;
            padding: 12px;
            font-size: 0.9rem;
        }
        
        @media (min-width: 768px) {
            .modal-buttons .btn {
                padding: 14px;
                font-size: 1rem;
            }
        }
        
        .modal-buttons .btn-secondary {
            background: #e2e8f0;
            color: #475569;
            box-shadow: none;
            border: 1px solid #cbd5e1;
        }
        
        .modal-buttons .btn-secondary:hover {
            background: #cbd5e1;
            transform: translateY(-2px);
        }
        
        .note-cell {
            max-width: 200px;
            white-space: normal;
            word-wrap: break-word;
            line-height: 1.4;
            font-size: 0.85rem;
        }
        
        @media (min-width: 768px) {
            .note-cell {
                max-width: 250px;
                line-height: 1.5;
                font-size: 0.9rem;
            }
        }
        
        .hidden {
            display: none;
        }
        
        .message {
            color: #b91c1c;
            margin: 10px 0;
            padding: 10px 16px;
            background: #fef2f2;
            border-radius: 30px;
            border: 1px solid #fecaca;
            font-size: 0.9rem;
        }
        
        @media (min-width: 768px) {
            .message {
                margin: 15px 0;
                padding: 12px 20px;
                font-size: 0.95rem;
            }
        }
        
        .success {
            color: #2b6e9b;
            padding: 10px 16px;
            background: #e6f0f7;
            border-radius: 30px;
            border: 1px solid #c1d9ec;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        @media (min-width: 768px) {
            .success {
                padding: 12px 20px;
                font-size: 0.95rem;
                margin: 15px 0;
            }
        }
        
        .password-cell {
            cursor: pointer;
            user-select: none;
            padding: 4px 0;
        }
        
        @media (min-width: 768px) {
            .password-cell {
                padding: 8px 0;
            }
        }
        
        .password-hidden {
            font-family: monospace;
            background: #f1f5f9;
            padding: 4px 8px;
            border-radius: 20px;
            color: #94a3b8;
            display: inline-block;
            transition: all 0.2s ease;
            font-size: 0.8rem;
        }
        
        @media (min-width: 768px) {
            .password-hidden {
                padding: 8px 16px;
                border-radius: 30px;
                font-size: 0.9rem;
            }
        }
        
        .password-hidden:hover {
            background: #e2e8f0;
        }
        
        .password-visible {
            font-family: monospace;
            background: #f1f5f9;
            padding: 4px 8px;
            border-radius: 20px;
            color: #0f172a;
            display: inline-block;
            font-weight: 500;
            font-size: 0.8rem;
        }
        
        @media (min-width: 768px) {
            .password-visible {
                padding: 8px 16px;
                border-radius: 30px;
                font-size: 0.9rem;
            }
        }
        
        .location-tag {
            background: #e6f0f7;
            border-radius: 12px;
            padding: 3px 6px;
            font-size: 0.75rem;
            color: #1d4f73;
            display: inline-block;
            max-width: 100%;
            word-break: break-word;
        }
        
        @media (min-width: 768px) {
            .location-tag {
                border-radius: 16px;
                padding: 4px 8px;
                font-size: 0.8rem;
            }
        }
        
        .note-tag {
            background: #fff3cd;
            border-radius: 12px;
            padding: 3px 6px;
            font-size: 0.75rem;
            color: #856404;
            display: inline-block;
            max-width: 100%;
            word-break: break-word;
            line-height: 1.4;
        }
        
        @media (min-width: 768px) {
            .note-tag {
                border-radius: 16px;
                padding: 4px 8px;
                font-size: 0.8rem;
                line-height: 1.5;
            }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .panel {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* æ‰‹æœºç«¯å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 480px) {
            .navbar {
                padding: 12px 16px;
            }
            
            .navbar h2 {
                font-size: 1.2rem;
            }
            
            .btn {
                padding: 5px 10px;
                font-size: 0.75rem;
            }
            
            .panel {
                padding: 15px;
            }
            
            .panel h3 {
                font-size: 1.2rem;
                margin-bottom: 12px;
            }
            
            .panel h4 {
                font-size: 1rem;
                margin: 15px 0 10px;
            }
            
            th {
                padding: 8px 4px;
                font-size: 0.75rem;
            }
            
            td {
                padding: 8px 4px;
                font-size: 0.75rem;
            }
            
            .action-buttons {
                gap: 4px;
                flex-direction: column;
            }
            
            .btn-group {
                padding: 12px;
                gap: 8px;
            }
            
            .time-input-group {
                gap: 4px;
            }
            
            .time-input-group input {
                min-width: 70px;
            }
            
            .location-tag, .note-tag {
                font-size: 0.7rem;
                padding: 2px 4px;
            }
            
            .password-hidden, .password-visible {
                padding: 2px 6px;
                font-size: 0.7rem;
            }
            
            .modal-content {
                padding: 15px;
            }
            
            .modal-content h3 {
                font-size: 1.2rem;
                margin-bottom: 12px;
            }
            
            .modal-form .form-row label {
                font-size: 0.8rem;
            }
            
            .modal-form .form-row input,
            .modal-form .form-row select,
            .modal-form .form-row textarea {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .modal-form .time-row span {
                font-size: 0.8rem;
            }
            
            .modal-buttons .btn {
                padding: 10px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <h2>ğŸ§ª DCC ç®¡ç†åå°</h2>
        <button class="btn" id="logoutBtn">é€€å‡ºç™»å½•</button>
    </div>

    <div class="container">
        <!-- å¯æ»‘åŠ¨çš„é€‰é¡¹å¡ -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="courses">ğŸ“… æ’è¯¾ç®¡ç†</button>
                <button class="tab-btn" data-tab="instructors">ğŸ‘¥ è®²å¸ˆç®¡ç†</button>
                <button class="tab-btn" data-tab="users">ğŸ‘¤ å­¦å‘˜ç®¡ç†</button>
                <button class="tab-btn" data-tab="registrations">ğŸ“‹ æŠ¥ååˆ—è¡¨</button>
            </div>
        </div>

        <!-- æ’è¯¾ç®¡ç†é¢æ¿ -->
        <div class="panel" id="coursesPanel">
            <h3>ğŸ“… è¯¾ç¨‹åˆ—è¡¨</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ</th>
                            <th>æ—¶é—´</th>
                            <th>è®²å¸ˆ</th>
                            <th>è¯¾ç¨‹åç§°</th>
                            <th>åœ°ç‚¹</th>
                            <th>å¤‡æ³¨</th>
                            <th>çŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="coursesTable">
                        <tr><td colspan="8" style="text-align:center; padding:40px;">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <h4>â• æ–°å¢è¯¾ç¨‹</h4>
            <div class="btn-group">
                <input type="date" id="newCourseDate" required>
                
                <!-- æ—¶é—´æ®µé€‰æ‹© -->
                <div class="time-input-group">
                    <input type="time" id="newStartTime" placeholder="å¼€å§‹æ—¶é—´" required>
                    <span class="time-separator">è‡³</span>
                    <input type="time" id="newEndTime" placeholder="ç»“æŸæ—¶é—´" required>
                </div>
                
                <select id="newCourseInstructor" required>
                    <option value="">é€‰æ‹©è®²å¸ˆ</option>
                </select>
                
                <input type="text" id="newCourseName" placeholder="è¯¾ç¨‹åç§°" required>
                
                <!-- åœ°ç‚¹è¾“å…¥ -->
                <input type="text" id="newCourseLocation" placeholder="ä¸Šè¯¾åœ°ç‚¹">
                
                <!-- å¤‡æ³¨è¾“å…¥ -->
                <textarea id="newCourseNote" placeholder="å¤‡æ³¨" rows="2"></textarea>
                
                <button class="btn" id="addCourseBtn">æ·»åŠ è¯¾ç¨‹</button>
            </div>
            <div id="courseMessage" class="message"></div>
        </div>

        <!-- è®²å¸ˆç®¡ç†é¢æ¿ -->
        <div class="panel hidden" id="instructorsPanel">
            <h3>ğŸ‘¥ è®²å¸ˆåˆ—è¡¨</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>å§“å</th>
                            <th>ä¸“é•¿</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="instructorsTable">
                        <tr><td colspan="3" style="text-align:center; padding:40px;">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <h4>â• æ·»åŠ è®²å¸ˆ</h4>
            <div class="btn-group">
                <input type="text" id="newInstName" placeholder="è®²å¸ˆå§“å">
                <input type="text" id="newInstSpecialty" placeholder="ä¸“é•¿">
                <button class="btn" id="addInstructorBtn">æ·»åŠ è®²å¸ˆ</button>
            </div>
            <div id="instructorMessage" class="message"></div>
        </div>

        <!-- å­¦å‘˜ç®¡ç†é¢æ¿ -->
        <div class="panel hidden" id="usersPanel">
            <h3>ğŸ‘¤ å­¦å‘˜åˆ—è¡¨</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>å§“å</th>
                            <th>å¯†ç </th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="usersTable">
                        <tr><td colspan="3" style="text-align:center; padding:40px;">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
            <div id="userMessage" class="message"></div>
        </div>

        <!-- æŠ¥ååˆ—è¡¨é¢æ¿ -->
        <div class="panel hidden" id="registrationsPanel">
            <h3>ğŸ“‹ æ‰€æœ‰æŠ¥åè®°å½•</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>å­¦å‘˜</th>
                            <th>è¯¾ç¨‹</th>
                            <th>æ—¥æœŸ</th>
                            <th>æ—¶é—´</th>
                            <th>è®²å¸ˆ</th>
                            <th>åœ°ç‚¹</th>
                            <th>å¤‡æ³¨</th>
                            <th>çŠ¶æ€</th>
                            <th>æŠ¥åæ—¶é—´</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="registrationsTable">
                        <tr><td colspan="10" style="text-align:center; padding:40px;">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ä¿®æ”¹è¯¾ç¨‹å¼¹çª— -->
    <div class="modal-overlay" id="editModal">
        <div class="modal-content">
            <h3>âœï¸ ä¿®æ”¹è¯¾ç¨‹</h3>
            <div class="modal-form">
                <div class="form-row">
                    <label>ğŸ“… æ—¥æœŸ</label>
                    <input type="date" id="editDate" required>
                </div>
                
                <div class="form-row">
                    <label>â° æ—¶é—´</label>
                    <div class="time-row">
                        <input type="time" id="editStartTime" required>
                        <span>è‡³</span>
                        <input type="time" id="editEndTime" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <label>ğŸ‘¨â€ğŸ« è®²å¸ˆ</label>
                    <select id="editInstructor" required>
                        <option value="">é€‰æ‹©è®²å¸ˆ</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <label>ğŸ“š è¯¾ç¨‹åç§°</label>
                    <input type="text" id="editCourseName" placeholder="è¯¾ç¨‹åç§°" required>
                </div>
                
                <div class="form-row">
                    <label>ğŸ“ åœ°ç‚¹</label>
                    <input type="text" id="editLocation" placeholder="ä¸Šè¯¾åœ°ç‚¹">
                </div>
                
                <div class="form-row">
                    <label>ğŸ“ å¤‡æ³¨</label>
                    <textarea id="editNote" placeholder="å¤‡æ³¨" rows="3"></textarea>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="btn" id="saveEditBtn">ä¿å­˜ä¿®æ”¹</button>
                <button class="btn btn-secondary" id="closeEditBtn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://fdwacsuphbpxfariohan.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZkd2Fjc3VwaGJweGZhcmlvaGFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExMDM1MzcsImV4cCI6MjA4NjY3OTUzN30.q1CzBhIw8xVYL4efkTvGYLkeC04dnBSCPcAWk7LHxxU';
        
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        if (sessionStorage.getItem('userRole') !== 'admin') {
            window.location.href = 'index.html';
        }

        let visiblePasswords = {};
        let currentEditCourse = null;

        // å¼¹çª—å…ƒç´ 
        const editModal = document.getElementById('editModal');
        const editDate = document.getElementById('editDate');
        const editStartTime = document.getElementById('editStartTime');
        const editEndTime = document.getElementById('editEndTime');
        const editInstructor = document.getElementById('editInstructor');
        const editCourseName = document.getElementById('editCourseName');
        const editLocation = document.getElementById('editLocation');
        const editNote = document.getElementById('editNote');
        const saveEditBtn = document.getElementById('saveEditBtn');
        const closeEditBtn = document.getElementById('closeEditBtn');

        // å…³é—­å¼¹çª—
        closeEditBtn.onclick = function() {
            editModal.classList.remove('active');
            currentEditCourse = null;
        };

        editModal.onclick = function(e) {
            if (e.target === editModal) {
                editModal.classList.remove('active');
                currentEditCourse = null;
            }
        };

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.onclick = function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                document.querySelectorAll('.panel').forEach(p => p.classList.add('hidden'));
                document.getElementById(this.dataset.tab + 'Panel').classList.remove('hidden');
                
                if (this.dataset.tab === 'instructors') {
                    loadInstructors();
                } else if (this.dataset.tab === 'courses') {
                    loadCourses();
                } else if (this.dataset.tab === 'users') {
                    loadUsers();
                } else if (this.dataset.tab === 'registrations') {
                    loadRegistrations();
                }
            };
        });

        window.onload = function() {
            loadInstructors();
            loadCourses();
            loadUsers();
            loadRegistrations();
        };

        function togglePassword(userId) {
            visiblePasswords[userId] = !visiblePasswords[userId];
            loadUsers();
        }

        async function loadUsers() {
            const { data, error } = await supabaseClient
                .from('users')
                .select('*')
                .eq('role', 'student')
                .order('id');
            
            if (error) {
                document.getElementById('usersTable').innerHTML = `<tr><td colspan="3" style="color:red; padding:40px;">åŠ è½½å¤±è´¥ï¼š${error.message}</td></tr>`;
                return;
            }
            
            const tbody = document.getElementById('usersTable');
            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:40px;">æš‚æ— å­¦å‘˜</td></tr>';
            } else {
                let html = '';
                data.forEach(user => {
                    const isVisible = visiblePasswords[user.id] || false;
                    
                    html += `<tr>
                        <td>${user.name}</td>
                        <td class="password-cell" onclick="togglePassword('${user.id}')">
                            ${isVisible 
                                ? `<span class="password-visible">${user.password}</span>` 
                                : `<span class="password-hidden">â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>`}
                        </td>
                        <td><button class="btn-danger btn" onclick="deleteUser('${user.id}')">åˆ é™¤</button></td>
                    </tr>`;
                });
                tbody.innerHTML = html;
            }
        }

        window.deleteUser = async function(id) {
            const { error } = await supabaseClient
                .from('users')
                .delete()
                .eq('id', id);
            
            if (error) {
                document.getElementById('userMessage').innerText = 'åˆ é™¤å¤±è´¥ï¼š' + error.message;
            } else {
                document.getElementById('userMessage').innerText = 'âœ… åˆ é™¤æˆåŠŸ';
                delete visiblePasswords[id];
                loadUsers();
            }
        };

        async function loadInstructors() {
            const { data, error } = await supabaseClient
                .from('instructors')
                .select('*')
                .order('id');
            
            if (error) {
                document.getElementById('instructorsTable').innerHTML = `<tr><td colspan="3" style="color:red; padding:40px;">åŠ è½½å¤±è´¥ï¼š${error.message}</td></tr>`;
                return;
            }
            
            const tbody = document.getElementById('instructorsTable');
            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:40px;">æš‚æ— è®²å¸ˆï¼Œè¯·æ·»åŠ </td></tr>';
            } else {
                let html = '';
                data.forEach(inst => {
                    html += `<tr>
                        <td>${inst.name}</td>
                        <td>${inst.specialty}</td>
                        <td><button class="btn-danger btn" onclick="deleteInstructor('${inst.id}')">åˆ é™¤</button></td>
                    </tr>`;
                });
                tbody.innerHTML = html;
            }
            
            const newSelect = document.getElementById('newCourseInstructor');
            newSelect.innerHTML = '<option value="">é€‰æ‹©è®²å¸ˆ</option>';
            
            const editSelect = document.getElementById('editInstructor');
            editSelect.innerHTML = '<option value="">é€‰æ‹©è®²å¸ˆ</option>';
            
            if (data) {
                data.forEach(inst => {
                    newSelect.innerHTML += `<option value="${inst.id}">${inst.name}</option>`;
                    editSelect.innerHTML += `<option value="${inst.id}">${inst.name}</option>`;
                });
            }
        }

        window.deleteInstructor = async function(id) {
            const { error } = await supabaseClient
                .from('instructors')
                .delete()
                .eq('id', id);
            
            if (error) {
                document.getElementById('instructorMessage').innerText = 'åˆ é™¤å¤±è´¥ï¼š' + error.message;
            } else {
                document.getElementById('instructorMessage').innerText = 'âœ… åˆ é™¤æˆåŠŸ';
                loadInstructors();
                loadCourses();
            }
        };

        document.getElementById('addInstructorBtn').onclick = async function() {
            const name = document.getElementById('newInstName').value.trim();
            const specialty = document.getElementById('newInstSpecialty').value.trim();
            
            if (!name || !specialty) {
                document.getElementById('instructorMessage').innerText = 'è¯·å¡«å†™å®Œæ•´';
                return;
            }
            
            const { error } = await supabaseClient
                .from('instructors')
                .insert([{ name, specialty }]);
            
            if (error) {
                document.getElementById('instructorMessage').innerText = 'æ·»åŠ å¤±è´¥ï¼š' + error.message;
            } else {
                document.getElementById('newInstName').value = '';
                document.getElementById('newInstSpecialty').value = '';
                document.getElementById('instructorMessage').innerText = 'âœ… æ·»åŠ æˆåŠŸ';
                loadInstructors();
            }
        };

        function isCourseEnded(courseDate) {
            const now = new Date();
            const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            const todayStr = beijingTime.toISOString().split('T')[0];
            return courseDate < todayStr;
        }

        async function loadCourses() {
            const { data, error } = await supabaseClient
                .from('courses')
                .select('*, instructors(*)')
                .order('date', { ascending: false });
            
            if (error) {
                document.getElementById('coursesTable').innerHTML = `<tr><td colspan="8" style="color:red; padding:40px;">åŠ è½½å¤±è´¥ï¼š${error.message}</td></tr>`;
                return;
            }
            
            const tbody = document.getElementById('coursesTable');
            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding:40px;">æš‚æ— è¯¾ç¨‹</td></tr>';
            } else {
                const now = new Date();
                const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
                const todayStr = beijingTime.toISOString().split('T')[0];
                
                const tomorrow = new Date(beijingTime);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = tomorrow.toISOString().split('T')[0];
                
                let html = '';
                data.forEach(c => {
                    const timeRange = c.time_range || 'å¾…å®š';
                    const location = c.location || 'æœªæŒ‡å®š';
                    const note = c.note || 'æ— ';
                    const isEnded = isCourseEnded(c.date);
                    
                    let rowClass = '';
                    let statusBadge = '';
                    
                    if (isEnded) {
                        rowClass = 'ended-course';
                        statusBadge = '<span class="ended-badge">å·²ç»“æŸ</span>';
                    } else if (c.date === todayStr) {
                        rowClass = 'today-highlight';
                        statusBadge = '<span class="badge badge-today">ä»Šå¤©</span>';
                    } else if (c.date === tomorrowStr) {
                        rowClass = 'tomorrow-highlight';
                        statusBadge = '<span class="badge badge-tomorrow">æ˜å¤©</span>';
                    } else {
                        statusBadge = '<span class="badge" style="background:#e2e8f0; color:#475569;">æœªå¼€å§‹</span>';
                    }
                    
                    html += `<tr class="${rowClass}">
                        <td>${c.date}</td>
                        <td>${timeRange}</td>
                        <td>${c.instructors?.name || 'æœªçŸ¥'}</td>
                        <td>${c.course_name}</td>
                        <td><span class="location-tag">${location}</span></td>
                        <td><span class="note-tag">${note}</span></td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-edit" onclick="openEditModal('${c.id}')">ä¿®æ”¹</button>
                                <button class="btn btn-danger" onclick="deleteCourse('${c.id}')">åˆ é™¤</button>
                            </div>
                        </td>
                    </tr>`;
                });
                tbody.innerHTML = html;
            }
        }

        window.openEditModal = async function(courseId) {
            const { data, error } = await supabaseClient
                .from('courses')
                .select('*')
                .eq('id', courseId)
                .single();
            
            if (error) {
                alert('è·å–è¯¾ç¨‹ä¿¡æ¯å¤±è´¥ï¼š' + error.message);
                return;
            }
            
            currentEditCourse = data;
            
            let startTime = '15:30';
            let endTime = '17:00';
            if (data.time_range && data.time_range.includes('-')) {
                [startTime, endTime] = data.time_range.split('-');
            }
            
            editDate.value = data.date;
            editStartTime.value = startTime;
            editEndTime.value = endTime;
            editInstructor.value = data.instructor_id;
            editCourseName.value = data.course_name;
            editLocation.value = data.location || '';
            editNote.value = data.note || '';
            
            editModal.classList.add('active');
        };

        saveEditBtn.onclick = async function() {
            if (!currentEditCourse) return;
            
            const date = editDate.value;
            const startTime = editStartTime.value;
            const endTime = editEndTime.value;
            const instructor_id = editInstructor.value;
            const course_name = editCourseName.value.trim();
            const location = editLocation.value.trim();
            const note = editNote.value.trim();
            
            if (!date || !startTime || !endTime || !instructor_id || !course_name) {
                alert('è¯·å¡«å†™å¿…å¡«ä¿¡æ¯ï¼ˆæ—¥æœŸã€æ—¶é—´ã€è®²å¸ˆã€è¯¾ç¨‹åç§°ï¼‰');
                return;
            }
            
            const time_range = `${startTime}-${endTime}`;
            
            const { error } = await supabaseClient
                .from('courses')
                .update({
                    date,
                    time_range,
                    instructor_id,
                    course_name,
                    location: location || 'å¾…å®š',
                    note: note || 'æ— '
                })
                .eq('id', currentEditCourse.id);
            
            if (error) {
                alert('ä¿®æ”¹å¤±è´¥ï¼š' + error.message);
            } else {
                alert('âœ… ä¿®æ”¹æˆåŠŸ');
                editModal.classList.remove('active');
                currentEditCourse = null;
                loadCourses();
            }
        };

        window.deleteCourse = async function(id) {
            const { error } = await supabaseClient
                .from('courses')
                .delete()
                .eq('id', id);
            
            if (error) {
                document.getElementById('courseMessage').innerText = 'åˆ é™¤å¤±è´¥ï¼š' + error.message;
            } else {
                document.getElementById('courseMessage').innerText = 'âœ… åˆ é™¤æˆåŠŸ';
                loadCourses();
            }
        };

        document.getElementById('addCourseBtn').onclick = async function() {
            const date = document.getElementById('newCourseDate').value;
            const startTime = document.getElementById('newStartTime').value;
            const endTime = document.getElementById('newEndTime').value;
            const instructor_id = document.getElementById('newCourseInstructor').value;
            const course_name = document.getElementById('newCourseName').value.trim();
            const location = document.getElementById('newCourseLocation').value.trim();
            const note = document.getElementById('newCourseNote').value.trim();
            
            if (!date || !startTime || !endTime || !instructor_id || !course_name) {
                document.getElementById('courseMessage').innerText = 'è¯·å¡«å†™å¿…å¡«ä¿¡æ¯ï¼ˆæ—¥æœŸã€æ—¶é—´ã€è®²å¸ˆã€è¯¾ç¨‹åç§°ï¼‰';
                return;
            }
            
            const time_range = `${startTime}-${endTime}`;
            
            const { error } = await supabaseClient
                .from('courses')
                .insert([{ 
                    date, 
                    time_range,
                    instructor_id, 
                    course_name,
                    location: location || 'å¾…å®š',
                    note: note || 'æ— '
                }]);
            
            if (error) {
                document.getElementById('courseMessage').innerText = 'æ·»åŠ å¤±è´¥ï¼š' + error.message;
            } else {
                document.getElementById('newCourseDate').value = '';
                document.getElementById('newStartTime').value = '';
                document.getElementById('newEndTime').value = '';
                document.getElementById('newCourseName').value = '';
                document.getElementById('newCourseLocation').value = '';
                document.getElementById('newCourseNote').value = '';
                document.getElementById('courseMessage').innerText = 'âœ… æ·»åŠ æˆåŠŸ';
                loadCourses();
            }
        };

        async function loadRegistrations() {
            const { data, error } = await supabaseClient
                .from('registrations')
                .select('*, courses(*, instructors(*)), users(name)')
                .order('registered_at', { ascending: false });
            
            if (error) {
                document.getElementById('registrationsTable').innerHTML = `<tr><td colspan="10" style="color:red; padding:40px;">åŠ è½½å¤±è´¥ï¼š${error.message}</td></tr>`;
                return;
            }
            
            const tbody = document.getElementById('registrationsTable');
            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align:center; padding:40px;">æš‚æ— æŠ¥åè®°å½•</td></tr>';
            } else {
                const now = new Date();
                const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
                const todayStr = beijingTime.toISOString().split('T')[0];
                
                const tomorrow = new Date(beijingTime);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = tomorrow.toISOString().split('T')[0];
                
                const sortedData = [...data].sort((a, b) => {
                    const dateA = a.courses?.date || '0000-00-00';
                    const dateB = b.courses?.date || '0000-00-00';
                    return dateB.localeCompare(dateA);
                });
                
                let html = '';
                sortedData.forEach(r => {
                    const timeRange = r.courses?.time_range || 'å¾…å®š';
                    const location = r.courses?.location || 'æœªæŒ‡å®š';
                    const note = r.courses?.note || 'æ— ';
                    const courseDate = r.courses?.date;
                    const isEnded = isCourseEnded(courseDate);
                    
                    let rowClass = '';
                    let statusBadge = '';
                    
                    if (isEnded) {
                        rowClass = 'ended-course';
                        statusBadge = '<span class="ended-badge">å·²ç»“æŸ</span>';
                    } else if (courseDate === todayStr) {
                        rowClass = 'today-highlight';
                        statusBadge = '<span class="badge badge-today">ä»Šå¤©</span>';
                    } else if (courseDate === tomorrowStr) {
                        rowClass = 'tomorrow-highlight';
                        statusBadge = '<span class="badge badge-tomorrow">æ˜å¤©</span>';
                    } else {
                        statusBadge = '<span class="badge" style="background:#e2e8f0; color:#475569;">æœªå¼€å§‹</span>';
                    }
                    
                    html += `<tr class="${rowClass}">
                        <td>${r.users?.name || r.student_name}</td>
                        <td>${r.courses?.course_name || '--'}</td>
                        <td>${courseDate || '--'}</td>
                        <td>${timeRange}</td>
                        <td>${r.courses?.instructors?.name || '--'}</td>
                        <td><span class="location-tag">${location}</span></td>
                        <td><span class="note-tag">${note}</span></td>
                        <td>${statusBadge}</td>
                        <td>${new Date(r.registered_at).toLocaleString()}</td>
                        <td><button class="btn-danger btn" onclick="deleteRegistration('${r.id}')">åˆ é™¤</button></td>
                    </tr>`;
                });
                tbody.innerHTML = html;
            }
        }

        window.deleteRegistration = async function(id) {
            const { error } = await supabaseClient
                .from('registrations')
                .delete()
                .eq('id', id);
            
            if (error) {
                document.getElementById('registrationsTable').innerHTML = `<tr><td colspan="10" style="color:red; padding:40px;">åˆ é™¤å¤±è´¥ï¼š${error.message}</td></tr>`;
            } else {
                loadRegistrations();
            }
        };

        document.getElementById('logoutBtn').onclick = function() {
            sessionStorage.clear();
            window.location.href = 'index.html';
        };
    </script>
</body>
</html>
